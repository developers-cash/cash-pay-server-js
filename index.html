<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home | JS/Node</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="">
        
            <a href="https://infra.cash" rel="noopener noreferrer" target="_blank">
                <img src="https://raw.githubusercontent.com/developers-cash/cash-pay-server/master/logo.svg" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">JS/Node</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="Config.html">Config</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Config_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Config.html#invoice">invoice</a></li><li><a href="Config.html#options">options</a></li></ul></div></li><li><a href="Invoice.html">Invoice</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Invoice_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Invoice.html#addAddress">addAddress</a></li><li><a href="Invoice.html#addOutput">addOutput</a></li><li><a href="Invoice.html#create">create</a></li><li><a href="Invoice.html#createFrom">createFrom</a></li><li><a href="Invoice.html#createFromExisting">createFromExisting</a></li><li><a href="Invoice.html#destroy">destroy</a></li><li><a href="Invoice.html#intoContainer">intoContainer</a></li><li><a href="Invoice.html#on">on</a></li><li><a href="Invoice.html#payload">payload</a></li><li><a href="Invoice.html#setAPIKey">setAPIKey</a></li><li><a href="Invoice.html#setData">setData</a></li><li><a href="Invoice.html#setExpires">setExpires</a></li><li><a href="Invoice.html#setMemo">setMemo</a></li><li><a href="Invoice.html#setMerchantData">setMerchantData</a></li><li><a href="Invoice.html#setPrivateData">setPrivateData</a></li><li><a href="Invoice.html#setUserCurrency">setUserCurrency</a></li><li><a href="Invoice.html#setWebhook">setWebhook</a></li></ul></div></li><li><a href="Signatures.html">Signatures</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Signatures_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Signatures.html#.refreshKeys">refreshKeys</a></li><li><a href="Signatures.html#.verifyEvent">verifyEvent</a></li><li><a href="Signatures.html#.verifyWebhook">verifyWebhook</a></li></ul></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    









    


    <section>
        <article class="readme"><h1>Cash-Pay-Server-JS</h1>
<p>Javascript/Node library for use with Cash Pay Server.</p>
<p>Documentation: <a href="https://developers-cash.github.io/cash-pay-server-js/">https://developers-cash.github.io/cash-pay-server-js/</a></p>
<h2>Quick Start</h2>
<p>Include the <code>cash-pay-server-js</code> NPM package in your project.</p>
<pre class="prettyprint source lang-bash"><code>npm install @developers.cash/cash-pay-server-js --save
</code></pre>
<p>... or alternatively, load it from a CDN:</p>
<pre class="prettyprint source lang-html"><code>&lt;script src=&quot;https://cdn.jsdelivr.net/npm/@developers.cash/cash-pay-server-js/dist/cashpay.min.js&quot;>&lt;/script>
</code></pre>
<p>Server-side Code for creating and marking as paid:</p>
<pre class="prettyprint source lang-javascript"><code>const CashPay = require('@developers-cash/cash-pay-server-js')

// ...

// Create invoice 
async function requestInvoice(req, res) {
  try {
    // Do things - get list of items in order, calculate totals, etc
    // req.body.items

    // Create the invoice
    let invoice = new CashPay.Invoice()
      .setAPIKey('someRandomString') // Optional (but allows use of Admin Interface)
      .addAddress('bitcoincash:qz8dt7dlwkc5n4x9u6gclfwte8lr7n58gyavxt0vmp', &quot;0.25USD&quot;)
    await invoice.create()
    
    // Save invoiceId to database, etc
    // const invoiceId = invoice.id

    // Return payload to client-side (ExpressJS Example)
    return res.send(invoice.payload())
  } catch (err) {
    return res.send(err)
  }
}

// Mark invoice as paid
async function invoicePaid(req, res) {
  try {
    // Verify signature of event (to prevent spoofing)
    await CashPay.Signatures.verifyEvent(req.body.event)
    
    // Do things - mark as paid in database, etc
    if (req.body.event.event === 'broadcasted') {
      // const invoiceId = event.invoice.id
    }
    
    return res.send({ status: 'ok' })
  } catch (err) {
    return res.send(err)
  }
}
</code></pre>
<p>Render the created invoice on your client-side</p>
<pre class="prettyprint source lang-html"><code>&lt;!-- head -->
&lt;script src=&quot;https://cdn.jsdelivr.net/npm/@developers.cash/cash-pay-server-js/dist/cashpay.min.js&quot;>&lt;/script>
&lt;!-- Or install via NPM -->

&lt;!-- body -->
&lt;div id=&quot;invoice-container&quot;>&lt;/div>

&lt;script>
async function fetchInvoice() {
  // Request invoice from server endpoint
  let invoice = new CashPay.Invoice()
    .intoContainer(document.getElementById('invoice-container'))
    .on(['broadcasted'], e => {
      axios.post('https://api.yoursite.com/invoice-paid', {
        event: e
      })
    
      invoice.destroy()
    })

  // Fetch the invoice that we created on the server-side
  await invoice.createFrom('https://api.yoursite.com/request-invoice', {
    items: ['ITEM_001', 'ITEM-002']
  })
}

fetchInvoice()
&lt;/script>
</code></pre>
<p>The default template uses inline SVG's and can be styled using CSS:</p>
<pre class="prettyprint source lang-css"><code>#invoice-container {
  margin: auto;
  max-width: 150px;
  font-size: 0.8em;
}

.cashpay-loading {
  fill: #00c58a !important;
}

.cashpay-tick {
  fill: #00c58a !important;
}

.cashpay-cross {
  fill: #F00 !important;
}
</code></pre>
<h2>Webhooks</h2>
<p>Webhooks are also available. Using Webhooks instead of the Websocket Events generally provides more resilience
over passing Websocket events to the server-side, but are also more difficult to implement as they require
a public facing URL.</p>
<pre class="prettyprint source lang-javascript"><code>async function requestInvoice(req, res) {
  // ...
  // It's recommended to include &quot;broadcasting&quot; even if you do not use it explicitly.
  // If your server is down and the &quot;broadcasting&quot; hook fails - the payment will not be broadcasted.
  invoice.setWebhook('https://api.your-site.com/webhook-endpoint', ['broadcasting', 'broadcasted', 'confirmed'])
  // ...
}

async function webhookEndpoint(req, res) {
  try {
    // Verify signature of event (to prevent spoofing) - or check API Key if you don't want to play with signatures
    await CashPay.Signatures.verifyWebhook(req.body, req.headers)
    
    // TODO You'll also want to check the InvoiceID to make sure YOU created this invoice
    
    if (req.body.event === 'broadcasted') {
      // Do things - mark as paid in database, etc
      
      // If a JSON response is given, you can modify &quot;data&quot; and &quot;privateData&quot; on the invoice.
      // 'data' will be available in the corresponding Websocket Event in the browser.
      return res.send({
        data: JSON.stringify({
          redirectURL: 'https://your-site.com/link-to-some-secure-file.mp4'
        })
        privateData: 'SomeOtherData'
      })
    }
    
    if (req.body.event === 'confirmed') {
      // Do things - mark as confirmed in database, etc
    }
    
    res.send({ status: 'OK' })
  } catch (err) {
    return res.send(err)
  }
}
</code></pre>
<p>Webhooks that do not give a 200 status code are considered failures.</p>
<h2>Using a different CashPayServer Instance</h2>
<p>See documentation about <a href="https://developers-cash.github.io/cash-pay-server/">Self-Hosting</a>.</p>
<pre class="prettyprint source lang-javascript"><code>const CashPay = require('@developers-cash/cash-pay-server-js')

CashPay.config.options.endpoint = 'https://pay.your-instance.com'

</code></pre>
<h2>Creating an Invoice Client-Side</h2>
<p>Invoices can also be created directly in the browser.</p>
<p>Note that creating the invoice in the browser is insecure for most use-cases.</p>
<p>However, it can be useful for testing.</p>
<pre class="prettyprint source lang-html"><code>&lt;!-- head -->
&lt;script src=&quot;https://cdn.jsdelivr.net/npm/@developers.cash/cash-pay-server-js/dist/cashpay.min.js&quot;>&lt;/script>

&lt;!-- body -->
&lt;div id=&quot;invoice-container&quot;>&lt;/div>

&lt;script>
// Create the invoice
async function createInvoice() {
  let invoice = new CashPay.Invoice()
    .intoContainer(document.getElementById('invoice-container'))
    .addAddress('bitcoincash:qz8dt7dlwkc5n4x9u6gclfwte8lr7n58gyavxt0vmp', &quot;0.25USD&quot;)
  await invoice.create()
}

createInvoice()
&lt;/script>
</code></pre>
<h2>Other common use-cases</h2>
<pre class="prettyprint source lang-javascript"><code>// Setting API Key across all new invoices
CashPay.config.invoice.apiKey = 'someRandomString'

// Changing the expiry time on an invoice
invoice.setExpires(60*5) // Five minutes

// Set the memo that the user sees in wallet
invoice.setMemo('Please confirm your order')

//Set Merchant Data (as per BIP70 spec)
invoice.setMerchantData(JSON.stringify({
  someWalletFeature: true
}))

// Set Public Data (will be available in WebSocket events - i.e. not private)
invoice.setData(&quot;InvoiceID:1000&quot;) // String
invoice.setData({
  redirectURL: '/download/someSecureFile.mp4'
})

// Set Private Data (only accessible through Admin and Webhooks)
invoice.setPrivateData(&quot;Some String&quot;) // String
invoice.setPrivateData({ some: &quot;String&quot;}) // Objects will be cast to a string

// Set user currency (Currency equivalent of BCH will be shown on rendered invoice)
invoice.setUserCurrency('AUD') // Australian Dollars
</code></pre>
<h2>Issues/Feature Requests</h2>
<p>Please submit any issues with the library to the <a href="https://github.com/developers-cash/cash-pay-server-js/issues">Github Repo's Issues Tracker</a>.</p>
<p>I'm also contactable on Telegram via <a href="https://t.me/jimtendo">https://t.me/jimtendo</a></p></article>
    </section>






</div>

<footer>
    <img class="logo" src="https://raw.githubusercontent.com/developers-cash/cash-pay-server/master/logo.svg" style="">
    <div class="footer-text"><a href="https://infra.cash">https://infra.cash</a></div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = 'package:undefined_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>